<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>model.components &mdash; P2Bldg 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            P2Bldg
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">P2Bldg</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">model.components</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for model.components</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">src/model/components.py</span>

<span class="sd">Core component and device model classes for the energy system optimisation framework.</span>

<span class="sd">Purpose:</span>

<span class="sd">- Define an extensible object model for system components (sources, sinks, nodes, links)</span>
<span class="sd">  and common technologies (PV, solar thermal, heat pumps, storages, heaters, imports/exports).</span>
<span class="sd">- Provide initialization, validation and derived-value calculations used by the optimisation model.</span>

<span class="sd">Main responsibilities:</span>

<span class="sd">- Component base: encapsulate costs, lifetimes, emissions and automatic levelled-cost calculation.</span>
<span class="sd">- Temperature levels: represent static or time-varying temperatures and heating-curve logic.</span>
<span class="sd">- Solar potential &amp; technologies: prepare PV/solar time series (normalised generation, irradiance)</span>
<span class="sd">  and wire potentials into PV and solar-thermal technology classes.</span>
<span class="sd">- Thermal and electrical nodes: group sources and sinks and enforce type consistency.</span>
<span class="sd">- Storage technologies: model electrical and thermal storages, capacities, efficiencies and degradation.</span>
<span class="sd">- Device-specific calculations: heating-curve parameter solving, COP/Qmax interpolation, thermal capacity</span>
<span class="sd">  computations and simple solar thermal performance estimation.</span>
<span class="sd">- Utility components: demand, flexible demand, heat gains, refurbishment and import/export wrappers.</span>

<span class="sd">Behavior and side effects:</span>

<span class="sd">- Many classes compute and expose time-series attributes (pandas Series/DataFrame) and summary values.</span>
<span class="sd">- SolarPotential may fetch and cache PVGIS data and call reduction utilities; some constructors call</span>
<span class="sd">  pickle helpers for caching (file I/O and network access possible).</span>
<span class="sd">- Classes are primarily data containers with derived-value helpers; they do not perform optimisation</span>
<span class="sd">  themselves but prepare inputs consumed by the optimisation model.</span>

<span class="sd">Dependencies:</span>

<span class="sd">- pandas, numpy</span>
<span class="sd">- project modules: `src.const`, `src.data_preparation.pvgis_climate_data`,</span>
<span class="sd">  `src.data_preparation.timeseries_reduction`, `src.model.economics`, `src.helper`</span>

<span class="sd">Intended use:</span>

<span class="sd">- Instantiate and configure system components for scenario setup, then pass configured objects into</span>
<span class="sd">  the optimisation pipeline which constructs models, constraints and objectives from these instances.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">src.const</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">const</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.const</span><span class="w"> </span><span class="kn">import</span> <span class="n">InputData</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.data_preparation.pvgis_climate_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_pvgis_hourly_data</span><span class="p">,</span> <span class="n">PvgisDataCols</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.data_preparation.timeseries_reduction</span><span class="w"> </span><span class="kn">import</span> <span class="n">prepare_ts_profiles</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.model.economics</span><span class="w"> </span><span class="kn">import</span> <span class="n">calc_inv_cost_with_residuals_and_reinvests</span><span class="p">,</span> <span class="n">calc_annuity</span><span class="p">,</span> \
    <span class="n">calc_constant_escalation_row</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">calc_for_blocks_of_n</span><span class="p">,</span> <span class="n">load_pickle</span><span class="p">,</span> <span class="n">dump_pickle</span><span class="p">,</span> <span class="n">create_ts_data_dump_id</span>


<div class="viewcode-block" id="Component"><a class="viewcode-back" href="../../model.html#model.components.Component">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Component</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all energy system components.</span>

<span class="sd">    Encapsulates common attributes for capacity, operational bounds, costs, lifetime and emissions.</span>
<span class="sd">    Performs levelled-cost calculations on initialization and assigns any additional keyword</span>
<span class="sd">    parameters as instance attributes.</span>

<span class="sd">    :param name: Component identifier.</span>
<span class="sd">    :param p_max: Maximum power capacity.</span>
<span class="sd">    :param p_max_rel_t: Relative maximum power over time (pd.Series or float).</span>
<span class="sd">    :param p_min: Minimum power capacity.</span>
<span class="sd">    :param p_min_rel_t: Relative minimum power over time (pd.Series or float).</span>
<span class="sd">    :param t_full_min: Minimum full-load hours.</span>
<span class="sd">    :param t_full_max: Maximum full-load hours.</span>
<span class="sd">    :param is_built: Boolean indicating whether the component is already installed.</span>
<span class="sd">    :param inv_cost: Investment cost (also applied at reinvestment).</span>
<span class="sd">    :param inv_cost_escalation_rate: Annual escalation rate for investment cost.</span>
<span class="sd">    :param fix_cost_inv: Fixed investment cost (also at reinvestment).</span>
<span class="sd">    :param fix_cost_inv_escalation_rate: Annual escalation rate for fixed investment cost.</span>
<span class="sd">    :param fix_cost_one_time: One-time fixed cost (incurred if built).</span>
<span class="sd">    :param fix_cost_one_time_escalation_rate: Annual escalation rate for one-time cost.</span>
<span class="sd">    :param fix_cost_yearly: Yearly fixed cost.</span>
<span class="sd">    :param fix_cost_yearly_escalation_rate: Annual escalation rate for yearly fixed cost.</span>
<span class="sd">    :param var_cost_t: Variable operational cost (pd.Series or float).</span>
<span class="sd">    :param var_cost_t_escalation_rate: Annual escalation rate for variable cost.</span>
<span class="sd">    :param lifetime: Operational lifetime in years.</span>
<span class="sd">    :param co2eq_per_cap: CO₂-equivalent per unit of capacity.</span>
<span class="sd">    :param co2eq_per_kwh_t: CO₂-equivalent per kWh over time (pd.Series or float).</span>
<span class="sd">    :param params: Additional dynamic attributes assigned to the instance.</span>

<span class="sd">    :ivar name: Component name.</span>
<span class="sd">    :ivar p_max: Maximum power capacity.</span>
<span class="sd">    :ivar p_min: Minimum power capacity.</span>
<span class="sd">    :ivar t_full_min: Minimum full-load hours.</span>
<span class="sd">    :ivar t_full_max: Maximum full-load hours.</span>
<span class="sd">    :ivar is_built: Installation state.</span>
<span class="sd">    :ivar inv_cost_levelled: Levelled investment cost per year.</span>
<span class="sd">    :ivar fix_cost_levelled: Levelled fixed yearly cost.</span>
<span class="sd">    :ivar fix_cost_one_time_levelled: Levelled one-time cost.</span>
<span class="sd">    :ivar var_cost_t_levelled: Levelled variable costs (series or scalar).</span>
<span class="sd">    :ivar lifetime: Lifetime in years.</span>
<span class="sd">    :ivar co2eq_per_cap: CO₂-equivalent per capacity.</span>
<span class="sd">    :ivar co2eq_per_kwh_t: Time series or scalar of CO₂ per kWh.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">p_max</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_P</span><span class="p">,</span> <span class="n">p_max_rel_t</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">p_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p_min_rel_t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">t_full_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t_full_max</span><span class="o">=</span><span class="mi">8760</span><span class="p">,</span>
                 <span class="n">is_built</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">inv_cost</span><span class="o">=</span><span class="mf">0.000000001</span><span class="p">,</span> <span class="n">inv_cost_escalation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">fix_cost_inv</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fix_cost_inv_escalation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">fix_cost_one_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fix_cost_one_time_escalation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">fix_cost_yearly</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fix_cost_yearly_escalation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">var_cost_t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">var_cost_t_escalation_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">lifetime</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">co2eq_per_kwh_t</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_max</span> <span class="o">=</span> <span class="n">p_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_max_rel_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">p_max_rel_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_min</span> <span class="o">=</span> <span class="n">p_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_min_rel_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">p_min_rel_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_full_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">t_full_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_full_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">t_full_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_built</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">is_built</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_cost</span> <span class="o">=</span> <span class="n">inv_cost</span>  <span class="c1"># also paid at every reinvest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_cost_escalation_rate</span> <span class="o">=</span> <span class="n">inv_cost_escalation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_inv</span> <span class="o">=</span> <span class="n">fix_cost_inv</span>  <span class="c1"># also paid at every reinvest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_inv_escalation_rate</span> <span class="o">=</span> <span class="n">fix_cost_inv_escalation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_one_time</span> <span class="o">=</span> <span class="n">fix_cost_one_time</span>  <span class="c1"># paid only once if built</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_one_time_escalation_rate</span> <span class="o">=</span> <span class="n">fix_cost_one_time_escalation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_yearly</span> <span class="o">=</span> <span class="n">fix_cost_yearly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_yearly_escalation_rate</span> <span class="o">=</span> <span class="n">fix_cost_yearly_escalation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_cost_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">var_cost_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_cost_t_escalation_rate</span> <span class="o">=</span> <span class="n">var_cost_t_escalation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifetime</span> <span class="o">=</span> <span class="n">lifetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">co2eq_per_cap</span> <span class="o">=</span> <span class="n">co2eq_per_cap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">co2eq_per_kwh_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">co2eq_per_kwh_t</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_calc_levelled_costs</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_levelled_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inv_cost_for_duration</span> <span class="o">=</span> <span class="n">calc_inv_cost_with_residuals_and_reinvests</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv_cost</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">escalation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_cost_escalation_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv_cost_levelled</span> <span class="o">=</span> <span class="n">calc_annuity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inv_cost_for_duration</span><span class="p">,</span>
                                              <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cost_inv_for_duration</span> <span class="o">=</span> <span class="n">calc_inv_cost_with_residuals_and_reinvests</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_inv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">escalation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_inv_escalation_rate</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_inv_levelled</span> <span class="o">=</span> <span class="n">calc_annuity</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fix_cost_inv_for_duration</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_levelled</span> <span class="o">=</span> <span class="n">calc_constant_escalation_row</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_yearly</span><span class="p">,</span> <span class="n">escalation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_yearly_escalation_rate</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_one_time_levelled</span> <span class="o">=</span> <span class="n">calc_annuity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fix_cost_one_time</span><span class="p">,</span>
                                                       <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_cost_t_levelled</span> <span class="o">=</span> <span class="n">calc_constant_escalation_row</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_cost_t</span><span class="p">,</span> <span class="n">escalation_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_cost_t_escalation_rate</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span> <span class="n">i_eff</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">REAL_INTEREST_RATE</span><span class="p">)</span></div>


<div class="viewcode-block" id="TempLevel"><a class="viewcode-back" href="../../model.html#model.components.TempLevel">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">TempLevel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a temperature level with associated information.</span>

<span class="sd">    This class is used to store and manage temperature levels. It holds the</span>
<span class="sd">    name of the level, the main temperature value, and optionally a series</span>
<span class="sd">    of temperature values. If the optional temperature series is not provided,</span>
<span class="sd">    the class will default it to the main temperature value.</span>

<span class="sd">    :ivar name: The name of the temperature level.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :ivar temp: The main temperature value associated with the level.</span>
<span class="sd">    :type temp: Any</span>
<span class="sd">    :ivar temp_t: The temperature series associated with the level if provided,</span>
<span class="sd">        otherwise defaults to the main temperature value.</span>
<span class="sd">    :type temp_t: pd.Series | int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span>

        <span class="k">if</span> <span class="n">temp_t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">temp_t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlowTempLevel"><a class="viewcode-back" href="../../model.html#model.components.FlowTempLevel">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">FlowTempLevel</span><span class="p">(</span><span class="n">TempLevel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class responsible for managing and calculating flow temperature levels, including the</span>
<span class="sd">    application of a heating curve for dynamic adjustments based on environmental and indoor</span>
<span class="sd">    temperature parameters.</span>

<span class="sd">    This class supports the configuration of a heating curve that dynamically updates flow</span>
<span class="sd">    temperature values based on input data like outdoor temperatures and heating thresholds.</span>
<span class="sd">    It also calculates reference and adjustable temperature values for flow and return</span>
<span class="sd">    temperatures, considering optional raised storage temperature values.</span>

<span class="sd">    :ivar flow_temp_ref: Reference value for the flow temperature.</span>
<span class="sd">    :ivar return_temp_ref: Reference value for the return temperature.</span>
<span class="sd">    :ivar temp_air_t: Time series data for outdoor air temperature when a heating curve is applied.</span>
<span class="sd">    :type temp_air_t: pandas.Series | None</span>
<span class="sd">    :ivar flow_temp_min: Minimum flow temperature when a heating curve is applied.</span>
<span class="sd">    :ivar outtemp_min_ref: Reference outdoor temperature for minimum heating conditions.</span>
<span class="sd">    :ivar indoortemp_ref: Reference indoor temperature for the heating curve.</span>
<span class="sd">    :ivar indoortemp_t: Time series data for indoor temperature adjustments. Only used when a</span>
<span class="sd">        heating curve is applied.</span>
<span class="sd">    :type indoortemp_t: pandas.Series | None</span>
<span class="sd">    :ivar heating_threshold: Outdoor temperature threshold for enabling the heating curve.</span>
<span class="sd">    :ivar flow_temp_t: Calculated flow temperature over time or as a constant depending on</span>
<span class="sd">        configuration.</span>
<span class="sd">    :type flow_temp_t: pandas.Series | int</span>
<span class="sd">    :ivar return_temp_t: Calculated return temperature over time or as a constant depending</span>
<span class="sd">        on configuration.</span>
<span class="sd">    :type return_temp_t: pandas.Series | int</span>
<span class="sd">    :ivar delta_temp_t: Difference between calculated flow and return temperatures.</span>
<span class="sd">    :ivar ret_flow_ratio: Ratio of return temperature to flow temperature when using the</span>
<span class="sd">        heating curve.</span>
<span class="sd">    :ivar _heating_curve_level: Level parameter of the calculated heating curve.</span>
<span class="sd">    :ivar _heating_curve_slope: Slope parameter of the calculated heating curve.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">flow_temp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_temp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">apply_heating_curve</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">temp_air_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">raised_storage_temp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">outtemp_min_ref</span><span class="o">=-</span><span class="mi">14</span><span class="p">,</span> <span class="n">indoortemp_ref</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">NOM_TEMP_INDOOR</span><span class="p">,</span> <span class="n">indoortemp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">heating_threshold</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">HEATING_THRESHOLD</span><span class="p">,</span> <span class="n">flow_temp_min</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_ref</span> <span class="o">=</span> <span class="n">flow_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_ref</span> <span class="o">=</span> <span class="n">return_temp</span>

        <span class="k">if</span> <span class="n">apply_heating_curve</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">temp_air_t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;temp_air_t needs to be given if apply_heating_curve=True&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span> <span class="o">=</span> <span class="n">temp_air_t</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_min</span> <span class="o">=</span> <span class="n">flow_temp_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outtemp_min_ref</span> <span class="o">=</span> <span class="n">outtemp_min_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span> <span class="o">=</span> <span class="n">indoortemp_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="n">indoortemp_t</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heating_threshold</span> <span class="o">=</span> <span class="n">heating_threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_heating_curve_params</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_flowtemp_t</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ret_flow_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_ref</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ret_flow_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span>
            <span class="k">if</span> <span class="n">raised_storage_temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span> <span class="o">=</span> <span class="n">raised_storage_temp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_temp_t</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_ref</span><span class="p">,</span> <span class="n">temp_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_t</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_heating_curve_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># solve param values level and slope for min and max flowtemp</span>

        <span class="n">d_out_in_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outtemp_min_ref</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span>
        <span class="n">d_out_in_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heating_threshold</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span>

        <span class="c1"># Define the non-linear parts of the equations</span>
        <span class="n">f_ref</span> <span class="o">=</span> <span class="n">d_out_in_ref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.4347</span> <span class="o">+</span> <span class="mf">0.021</span> <span class="o">*</span> <span class="n">d_out_in_ref</span> <span class="o">+</span> <span class="mf">247.9</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">d_out_in_ref</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">f_min</span> <span class="o">=</span> <span class="n">d_out_in_min</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.4347</span> <span class="o">+</span> <span class="mf">0.021</span> <span class="o">*</span> <span class="n">d_out_in_min</span> <span class="o">+</span> <span class="mf">247.9</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">d_out_in_min</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Set up the system of equations in matrix form</span>
        <span class="c1"># Form the coefficient matrix</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">f_ref</span><span class="p">],</span>  <span class="c1"># Coefficients for level and slope in equation 1</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">f_min</span><span class="p">]</span>  <span class="c1"># Coefficients for level and slope in equation 2</span>
        <span class="p">])</span>

        <span class="c1"># Right-hand side values (adjusting for RTSoll)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_ref</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span><span class="p">])</span>

        <span class="n">level</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">level</span><span class="p">,</span> <span class="n">slope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_flowtemp_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># flow temperature is calculated for daily min. temperature</span>
        <span class="n">ts_per_day</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">TS_PER_HOUR</span> <span class="o">*</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># d_out_in_t = self.outtemp_t - self.indoortemp_ref  # use hourly temperatures</span>
            <span class="n">d_out_in_t</span> <span class="o">=</span> <span class="n">calc_for_blocks_of_n</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="n">ts_per_day</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span>  <span class="c1"># use daily mean temp.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">: Nightly reduction of flow temperature activated.&quot;</span><span class="p">)</span>
            <span class="c1"># d_out_in_t = self.outtemp_t - self.indoortemp_t  # use hourly temperatures</span>
            <span class="n">d_out_in_t</span> <span class="o">=</span> <span class="n">calc_for_blocks_of_n</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="n">ts_per_day</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_t</span>  <span class="c1"># use daily mean temp.</span>

        <span class="k">return</span> <span class="n">d_out_in_t</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_t_vl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_slope</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_min</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_t_vl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_diff</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t_in_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">t_vl_min</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_level</span>
        <span class="k">if</span> <span class="n">slope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heating_curve_slope</span>
        <span class="k">if</span> <span class="n">t_in_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_in_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoortemp_ref</span>
        <span class="k">if</span> <span class="n">t_vl_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">t_vl_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_temp_min</span>

        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">t_in_ref</span> <span class="o">+</span> <span class="n">level</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">t_diff</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mf">1.4347</span> <span class="o">+</span> <span class="mf">0.021</span> <span class="o">*</span> <span class="n">t_diff</span> <span class="o">+</span> <span class="mf">247.9</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">t_diff</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">t_vl_min</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarPotential"><a class="viewcode-back" href="../../model.html#model.components.SolarPotential">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SolarPotential</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the calculation and management of solar potential for a specific surface orientation</span>
<span class="sd">    and setup. This class facilitates the preparation of time series for solar generation profiles based</span>
<span class="sd">    on input parameters such as surface tilt, azimuth angle, and horizon factors. It is used to calculate PV generation,</span>
<span class="sd">    Solar thermal generation and solar gains.</span>

<span class="sd">    This class is designed to calculate solar energy potential using data from PVGIS (Photovoltaic Geographical</span>
<span class="sd">    Information System). It allows the user to specify surface properties and other parameters affecting solar</span>
<span class="sd">    potential calculation. It processes and normalizes the time series data for efficient usage in further analysis.</span>

<span class="sd">    :ivar surface_tilt: The tilt angle of the surface for solar energy calculation.</span>
<span class="sd">    :ivar surface_azimuth: The azimuth (compass direction) angle of the surface for solar energy calculation.</span>
<span class="sd">    :ivar gen_ts_normalized: Time series of normalized energy generation potential.</span>
<span class="sd">    :type surface_tilt: float</span>
<span class="sd">    :type surface_azimuth: float</span>
<span class="sd">    :type gen_ts_normalized: pd.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">surface_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">surface_azimuth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gen_ts_normalized</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface_tilt</span><span class="p">,</span> <span class="n">surface_azimuth</span><span class="p">,</span> <span class="n">sel_weeks</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window_area_m2</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_AREA</span><span class="p">,</span>
                 <span class="n">window_g_val</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">solar_pot_area_m2</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_AREA</span><span class="p">,</span> <span class="n">rad_corr_factor</span><span class="o">=</span><span class="mf">0.41</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span> <span class="o">=</span> <span class="n">surface_tilt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span> <span class="o">=</span> <span class="n">surface_azimuth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon</span> <span class="o">=</span> <span class="n">horizon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_pvgis_ts</span><span class="p">(</span><span class="n">sel_weeks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_area_m2</span> <span class="o">=</span> <span class="n">window_area_m2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g_val</span> <span class="o">=</span> <span class="n">window_g_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_pot_area_m2</span> <span class="o">=</span> <span class="n">solar_pot_area_m2</span>
        <span class="c1"># r = product of correction factors: frame 0.7, incidence 0.85, dirt 0.95, shade 0.75 = 0.42</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rad_corr_factor</span> <span class="o">=</span> <span class="n">rad_corr_factor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pvgis_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel_weeks</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">red_ts</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_ts_data_dump_id</span><span class="p">()</span><span class="si">}</span><span class="s2">_solar_pot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">pv_gis_data</span> <span class="o">=</span> <span class="n">get_pvgis_hourly_data</span><span class="p">(</span><span class="n">surface_tilt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span><span class="p">,</span> <span class="n">surface_azimuth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span><span class="p">,</span>
                                                <span class="n">horizon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PV potential: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, tilt: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span><span class="si">}</span><span class="s2">°, azimuth </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span><span class="si">}</span><span class="s2">°: &quot;</span>
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pv_gis_data</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">P_el_t</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> kWh/kWp&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">const</span><span class="o">.</span><span class="n">TS_PER_HOUR</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">TS_RES</span><span class="o">.</span><span class="n">QUARTER_HOURLY</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">pv_gis_data</span><span class="o">.</span><span class="n">convert_to_quarter_hourly</span><span class="p">()</span>

            <span class="n">red_ts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">prepare_ts_profiles</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">InputData</span><span class="o">.</span><span class="n">PvgisData</span><span class="p">:</span> <span class="n">pv_gis_data</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">sel_weeks</span><span class="o">=</span><span class="n">sel_weeks</span>
            <span class="p">)</span>
            <span class="n">dump_pickle</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">create_ts_data_dump_id</span><span class="p">()</span><span class="si">}</span><span class="s2">_solar_pot_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">horizon</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">red_ts</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gen_ts_normalized</span> <span class="o">=</span> <span class="n">red_ts</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">P_el_t</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_rad_t</span> <span class="o">=</span> <span class="n">red_ts</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">Direct_rad</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_rad_t</span> <span class="o">=</span> <span class="n">red_ts</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">Direct_rad</span><span class="p">]</span> <span class="o">+</span> <span class="n">red_ts</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">Diffuse_rad_sky</span><span class="p">]</span> <span class="o">+</span> \
                           <span class="n">red_ts</span><span class="p">[</span><span class="n">PvgisDataCols</span><span class="o">.</span><span class="n">Diffuse_rad_ground</span><span class="p">]</span></div>


<div class="viewcode-block" id="SolarPotentialDummy"><a class="viewcode-back" href="../../model.html#model.components.SolarPotentialDummy">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SolarPotentialDummy</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">gen_ts_normalized</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_ts_normalized</span> <span class="o">=</span> <span class="n">gen_ts_normalized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_pot_area_m2</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">MAX_AREA</span></div>





<div class="viewcode-block" id="Source"><a class="viewcode-back" href="../../model.html#model.components.Source">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Source</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class a Source component. The model consists of sources, sinks and nodes.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="Sink"><a class="viewcode-back" href="../../model.html#model.components.Sink">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Sink</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class a Sink component. The model consists of sources, sinks and nodes.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElSource"><a class="viewcode-back" href="../../model.html#model.components.ElSource">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElSource</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Electrical source.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElSink"><a class="viewcode-back" href="../../model.html#model.components.ElSink">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElSink</span><span class="p">(</span><span class="n">Sink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Electrical sink.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThSource"><a class="viewcode-back" href="../../model.html#model.components.ThSource">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThSource</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thermal source.</span>

<span class="sd">    Can have one or more temperature levels, provided via</span>
<span class="sd">    the `temp_levels_feed` parameter. It ensures that the provided objects are valid</span>
<span class="sd">    and handles initialization in conjunction with its parent `Source` class.</span>

<span class="sd">    :ivar temp_levels_feed: A list containing `TempLevel` objects to be managed by this class.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temp_levels_feed</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">TempLevel</span><span class="p">),</span> <span class="s2">&quot;temp_levels_feed must be list of TempLevel objects&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span> <span class="o">=</span> <span class="n">temp_levels_feed</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ThSink attribute temp_levels_feed must not be None&quot;</span></div>


<div class="viewcode-block" id="ThSink"><a class="viewcode-back" href="../../model.html#model.components.ThSink">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThSink</span><span class="p">(</span><span class="n">Sink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thermal sink.</span>

<span class="sd">    Can have one or more temperature levels, provided via</span>
<span class="sd">    the `temp_levels_feed` parameter. It ensures that the provided objects are valid</span>
<span class="sd">    and handles initialization in conjunction with its parent `Source` class.</span>

<span class="sd">    :ivar temp_levels_feed: A list containing `TempLevel` objects to be managed by this class.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temp_levels_drain</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">TempLevel</span><span class="p">),</span> <span class="s2">&quot;temp_levels_drain must be list of TempLevel objects&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_drain</span> <span class="o">=</span> <span class="n">temp_levels_drain</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_drain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ThSink attribute temp_levels_drain must not be None&quot;</span></div>


<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../model.html#model.components.Node">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Node</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nodes are points for which energy balances are solved in the model, e.g. a temperature level&quot;&quot;&quot;</span>
    <span class="n">sources</span><span class="p">:</span> <span class="p">[</span><span class="n">Source</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sinks</span><span class="p">:</span> <span class="p">[</span><span class="n">Sink</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sinks</span> <span class="o">=</span> <span class="n">sinks</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThNode"><a class="viewcode-back" href="../../model.html#model.components.ThNode">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thermal node attributed with one specified temperature level.</span>
<span class="sd">    It is ensured that all associated sources and sinks are of the correct thermal types (ThSource and ThSink).</span>

<span class="sd">    :ivar temp_level: Temperature level associated with this node.</span>
<span class="sd">    :type temp_level: TempLevel</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="n">temp_level</span><span class="p">:</span><span class="n">TempLevel</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_level</span> <span class="o">=</span> <span class="n">temp_level</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_source_sink_types</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_source_sink_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">are_th_sinks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">ThSink</span><span class="p">)</span> <span class="k">for</span> <span class="n">sink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sinks</span><span class="p">]</span>
        <span class="n">are_th_sources</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">)</span> <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">are_th_sinks</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">all</span><span class="p">(</span><span class="n">are_th_sources</span><span class="p">))</span></div>


<div class="viewcode-block" id="RoomheatNode"><a class="viewcode-back" href="../../model.html#model.components.RoomheatNode">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">RoomheatNode</span><span class="p">(</span><span class="n">ThNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specilized thermal node for room heating.</span>

<span class="sd">    :ivar temperature: Represents the temperature of the room heating node,</span>
<span class="sd">        initialized to None by default.</span>
<span class="sd">    :type temperature: None or float or int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElNode"><a class="viewcode-back" href="../../model.html#model.components.ElNode">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElNode</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Electrical node.</span>

<span class="sd">    It is validated that all sources are instances of ElSource and all sinks are instances of ElSink.</span>

<span class="sd">    :ivar name: The name of the node.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :ivar sources: A list of source components connected to this node.</span>
<span class="sd">    :type sources: list</span>
<span class="sd">    :ivar sinks: A list of sink components connected to this node.</span>
<span class="sd">    :type sinks: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">sinks</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_source_sink_types</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_source_sink_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">are_el_sinks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">)</span> <span class="k">for</span> <span class="n">sink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sinks</span><span class="p">]</span>
        <span class="n">are_el_sources</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">ElSource</span><span class="p">)</span> <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">are_el_sinks</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">all</span><span class="p">(</span><span class="n">are_el_sources</span><span class="p">))</span></div>


<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../model.html#model.components.Link">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Link</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connection between two nodes.</span>

<span class="sd">    A class representing a connection between two nodes with an associated</span>
<span class="sd">    efficiency value. It integrates functionalities of both Source and Sink,</span>
<span class="sd">    and it can hold additional parameters provided during initialization.</span>

<span class="sd">    :ivar eff: Efficiency of the connection between the nodes.</span>
<span class="sd">    :type eff: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">eff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff</span> <span class="o">=</span> <span class="n">eff</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="HeatExchanger"><a class="viewcode-back" href="../../model.html#model.components.HeatExchanger">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">HeatExchanger</span><span class="p">(</span><span class="n">ThSink</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">,</span> <span class="n">Link</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a heat exchanger connecting two thermal nodes.</span>

<span class="sd">    A HeatExchanger facilitates the transfer of thermal energy between two</span>
<span class="sd">    systems. It can serve as both a thermodynamic source and sink. The primary</span>
<span class="sd">    usage of the HeatExchanger is defined by its feed and drain temperature</span>
<span class="sd">    levels.</span>

<span class="sd">    :ivar temp_levels_feed: Temperature levels of the feed fluid. Must contain exactly one temperature level.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    :ivar temp_levels_drain: Temperature levels of the drain fluid. Must contain exactly one temperature level.</span>
<span class="sd">    :type temp_levels_drain: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels_feed</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="o">=</span><span class="n">temp_levels_drain</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_drain</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> \
            <span class="s2">&quot;HeatExchanger can only have one feed and drain TempLevel&quot;</span></div>


<div class="viewcode-block" id="ElectricLine"><a class="viewcode-back" href="../../model.html#model.components.ElectricLine">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElectricLine</span><span class="p">(</span><span class="n">Link</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">,</span> <span class="n">ElSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents an electric line used to link two electrical nodes.</span>

<span class="sd">    The ElectricLine class connects electrical components, serving as both a sink</span>
<span class="sd">    and a source of electricity. It inherits from the Link, ElSink, and ElSource</span>
<span class="sd">    classes to handle its complex functionalities. It is primarily used in systems</span>
<span class="sd">    requiring bidirectional electrical flow or monitoring of connections.</span>

<span class="sd">    :ivar name: Name of the electric line.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarTechnology"><a class="viewcode-back" href="../../model.html#model.components.SolarTechnology">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SolarTechnology</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a general technology utilizing solar potential to generate power.</span>
<span class="sd">    Used as base class for PV and SolarThermal.</span>

<span class="sd">    This class is designed for solar energy technology, leveraging a defined</span>
<span class="sd">    potential (such as SolarPotential or SolarPotentialDummy). It includes</span>
<span class="sd">    attributes to define the surface tilt and azimuth for solar panel</span>
<span class="sd">    orientation and allows additional configuration through its constructor.</span>

<span class="sd">    :ivar potential: The solar potential (e.g., SolarPotential or</span>
<span class="sd">        SolarPotentialDummy) used by this technology.</span>
<span class="sd">    :type potential: SolarPotential | SolarPotentialDummy</span>
<span class="sd">    :ivar surface_tilt: The tilt angle of the solar panel surface, relative</span>
<span class="sd">        to the ground.</span>
<span class="sd">    :type surface_tilt: float</span>
<span class="sd">    :ivar surface_azimuth: The azimuthal angle of the solar panel, describing</span>
<span class="sd">        its orientation relative to true north.</span>
<span class="sd">    :type surface_azimuth: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">potential</span><span class="p">:</span> <span class="n">SolarPotential</span> <span class="o">|</span> <span class="n">SolarPotentialDummy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">surface_tilt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">surface_azimuth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">potential</span><span class="p">:</span> <span class="n">SolarPotential</span><span class="o">|</span><span class="n">SolarPotentialDummy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">kwp_per_m2</span><span class="o">=</span><span class="mf">0.23</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">potential</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SolarTechnology needs attribute potential&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwp_per_m2</span> <span class="o">=</span> <span class="n">kwp_per_m2</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="s1">&#39;surface_tilt&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span> <span class="o">=</span> <span class="n">potential</span><span class="o">.</span><span class="n">surface_tilt</span>
        <span class="k">elif</span> <span class="s1">&#39;surface_tilt&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;surface_tilt&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="n">SolarPotentialDummy</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;no param surface_tilt given&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="s1">&#39;surface_azimuth&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface_azimuth</span> <span class="o">=</span> <span class="n">potential</span><span class="o">.</span><span class="n">surface_azimuth</span>
        <span class="k">elif</span> <span class="s1">&#39;surface_azimuth&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surface_tilt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;surface_azimuth&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="n">SolarPotentialDummy</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;no param surface_azimuth given&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="n">co2eq_per_cap</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="PV"><a class="viewcode-back" href="../../model.html#model.components.PV">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">PV</span><span class="p">(</span><span class="n">SolarTechnology</span><span class="p">,</span> <span class="n">ElSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a photovoltaic (PV) system. This class provides</span>
<span class="sd">    properties and parameters necessary to model and evaluate the performance</span>
<span class="sd">    of a PV system over its lifecycle. The possible generation is given with the attributed SolarPotential.</span>

<span class="sd">    :ivar pmax_at_lifeend: The maximum power output as a fraction of initial</span>
<span class="sd">                           power at the end of the PV system&#39;s lifecycle.</span>
<span class="sd">    :type pmax_at_lifeend: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">potential</span><span class="p">:</span> <span class="n">SolarPotential</span> <span class="o">|</span> <span class="n">SolarPotentialDummy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">pmax_at_lifeend</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">kwp_per_m2</span><span class="o">=</span><span class="mf">0.23</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pmax_at_lifeend</span> <span class="o">=</span> <span class="n">pmax_at_lifeend</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="n">co2eq_per_cap</span><span class="p">,</span> <span class="n">kwp_per_m2</span><span class="o">=</span><span class="n">kwp_per_m2</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="SolarThermal"><a class="viewcode-back" href="../../model.html#model.components.SolarThermal">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SolarThermal</span><span class="p">(</span><span class="n">SolarTechnology</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a solar thermal system. This class serves as an extension of existing solar</span>
<span class="sd">    technology to focus on capturing and utilizing heat energy. It calculates the</span>
<span class="sd">    maximum possible thermal output based on specified parameters, environmental</span>
<span class="sd">    conditions, and collector efficiency.</span>

<span class="sd">    :ivar temp_levels_feed: List containing temperature levels of the feed for</span>
<span class="sd">        which the thermal energy output is calculated.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    :ivar temp_air_t: Time series data of ambient air temperature used for thermal</span>
<span class="sd">        calculations.</span>
<span class="sd">    :type temp_air_t: pd.Series</span>
<span class="sd">    :ivar eta0: Optical efficiency of the solar collector.</span>
<span class="sd">    :type eta0: float</span>
<span class="sd">    :ivar a1: Heat loss coefficient related to temperature difference (linear term).</span>
<span class="sd">    :type a1: float</span>
<span class="sd">    :ivar a2: Heat loss coefficient related to temperature difference (quadratic term).</span>
<span class="sd">    :type a2: float</span>
<span class="sd">    :ivar qmax_t: Dictionary mapping feed temperature levels to their maximum</span>
<span class="sd">        thermal output over time.</span>
<span class="sd">    :type qmax_t: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">potential</span><span class="p">:</span> <span class="n">SolarPotential</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_air_t</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">collector_type</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">STCollectorType</span><span class="o">.</span><span class="n">FLATPLATE_SINGLECOVER_SEL</span><span class="p">,</span>
                 <span class="n">kwp_per_m2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span> <span class="o">=</span> <span class="n">temp_levels_feed</span>
        <span class="k">assert</span> <span class="n">temp_air_t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SolarThermal needs temp_air_t attribute&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span> <span class="o">=</span> <span class="n">temp_air_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta0</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">STCollectorSpecs</span><span class="p">[</span><span class="n">collector_type</span><span class="p">][</span><span class="s1">&#39;eta0&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">STCollectorSpecs</span><span class="p">[</span><span class="n">collector_type</span><span class="p">][</span><span class="s1">&#39;a1&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">STCollectorSpecs</span><span class="p">[</span><span class="n">collector_type</span><span class="p">][</span><span class="s1">&#39;a2&#39;</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels_feed</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="n">co2eq_per_cap</span><span class="p">,</span>
                         <span class="n">kwp_per_m2</span><span class="o">=</span><span class="n">kwp_per_m2</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_qmax_t</span><span class="p">()</span>

<div class="viewcode-block" id="SolarThermal.calc_qmax_t"><a class="viewcode-back" href="../../model.html#model.components.SolarThermal.calc_qmax_t">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_qmax_t</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;from quaschning&quot;&quot;&quot;</span>
        <span class="n">qmax_t</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feed_temp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span><span class="p">:</span>
            <span class="n">delta_temp</span> <span class="o">=</span> <span class="n">feed_temp</span><span class="o">.</span><span class="n">temp_t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span>
            <span class="n">qmax_t</span><span class="p">[</span><span class="n">feed_temp</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential</span><span class="o">.</span><span class="n">total_rad_t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">*</span><span class="n">delta_temp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">*</span><span class="n">delta_temp</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>
            <span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qmax_t</span></div></div>


<div class="viewcode-block" id="Heatpump"><a class="viewcode-back" href="../../model.html#model.components.Heatpump">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Heatpump</span><span class="p">(</span><span class="n">ThSink</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class representing a heat pump system.</span>

<span class="sd">    This class allows users to specify the heat pump&#39;s temperature levels for both the source and the</span>
<span class="sd">    heat sink, along with the corresponding specifications for the coefficients of</span>
<span class="sd">    performance (COP) and maximum heat generation (Qmax) values. It also includes methods to interpolate</span>
<span class="sd">    and calculate these values based on given temperature levels. The class ensures</span>
<span class="sd">    that the heat pump can only have one drain temperature level.</span>

<span class="sd">    :ivar name: Name of the heatpump.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :ivar temp_levels_drain: List of temperature levels of the drain.</span>
<span class="sd">    :type temp_levels_drain: list</span>
<span class="sd">    :ivar temp_levels_feed: List of temperature levels of the feed.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    :ivar specs_table: DataFrame containing specifications for COP and Qmax.</span>
<span class="sd">    :type specs_table: pandas.DataFrame</span>
<span class="sd">    :ivar heating_threshold: Heating threshold value for the heat pump.</span>
<span class="sd">    :type heating_threshold: Any</span>
<span class="sd">    :ivar src_temp_t: Source temperature at the drain side.</span>
<span class="sd">    :type src_temp_t: Any</span>
<span class="sd">    :ivar cop_t: Computed coefficients of performance for the heat pump over time.</span>
<span class="sd">    :type cop_t: dict</span>
<span class="sd">    :ivar qmax_t: Computed maximum heating capacity for the heat pump over time.</span>
<span class="sd">    :type qmax_t: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">specs_table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">=</span> <span class="n">const</span><span class="o">.</span><span class="n">COP_TABLE</span><span class="p">[</span><span class="s1">&#39;air-water&#39;</span><span class="p">],</span>
                 <span class="n">heating_threshold</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">HEATING_THRESHOLD</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="o">=</span><span class="n">temp_levels_drain</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels_feed</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_drain</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Heatpump can only have one drain-TempLevel&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span> <span class="o">=</span> <span class="n">specs_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_drain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">temp_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heating_threshold</span> <span class="o">=</span> <span class="n">heating_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_values_for_flow_temps_to_cop_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cop_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_cop_series</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_qmax_series</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_values_for_flow_temps_to_cop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">temp_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span><span class="p">:</span>
            <span class="n">flow_temps_in_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;COP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_level</span><span class="o">.</span><span class="n">temp_t</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="n">flow_temps</span> <span class="o">=</span> <span class="n">temp_level</span><span class="o">.</span><span class="n">temp_t</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flow_temps</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_level</span><span class="o">.</span><span class="n">temp_t</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">flow_temp</span> <span class="ow">in</span> <span class="n">flow_temps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flow_temp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow_temps_in_spec</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;COP&#39;</span><span class="p">,</span> <span class="n">flow_temp</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Qmax&#39;</span><span class="p">,</span> <span class="n">flow_temp</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

            <span class="n">too_low_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">too_low_cond</span><span class="p">,:]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: COP and Qmax for flow temperatures &lt; </span><span class="si">{</span><span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">°C not in specs table of&quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Values for </span><span class="si">{</span><span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">°C are used.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;COP&#39;</span><span class="p">,</span> <span class="n">too_low_cond</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;COP&#39;</span><span class="p">,</span> <span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Qmax&#39;</span><span class="p">,</span> <span class="n">too_low_cond</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Qmax&#39;</span><span class="p">,</span> <span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>

            <span class="n">too_high_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">too_high_cond</span><span class="p">,:]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: COP and Qmax for flow temperatures &gt; </span><span class="si">{</span><span class="n">flow_temps_in_spec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">°C not in specs table of &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Values for higher temperatures are set to 0 (Heatpump cannot deliver flow temperature).&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;COP&#39;</span><span class="p">,</span> <span class="n">too_high_cond</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Qmax&#39;</span><span class="p">,</span> <span class="n">too_high_cond</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_cop_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cop_t</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">temp_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span><span class="p">:</span>
            <span class="n">src_n_flow_temp_t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="n">temp_level</span><span class="o">.</span><span class="n">temp_t</span><span class="p">,</span>
                    <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_temp_t</span><span class="p">,</span>
                <span class="p">},</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
            <span class="p">)</span>
            <span class="n">cop_t</span><span class="p">[</span><span class="n">temp_level</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_n_flow_temp_t</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;COP&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">])]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cop_t</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_qmax_series</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qmax_t</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">temp_level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels_feed</span><span class="p">:</span>
            <span class="n">src_n_flow_temp_t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s1">&#39;flow&#39;</span><span class="p">:</span> <span class="n">temp_level</span><span class="o">.</span><span class="n">temp_t</span><span class="p">,</span>
                    <span class="s1">&#39;src&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">src_temp_t</span><span class="p">,</span>
                <span class="p">},</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
            <span class="p">)</span>
            <span class="n">qmax_t</span><span class="p">[</span><span class="n">temp_level</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_n_flow_temp_t</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;src&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specs_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Qmax&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;flow&#39;</span><span class="p">])]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qmax_t</span></div>


<div class="viewcode-block" id="CombustionHeater"><a class="viewcode-back" href="../../model.html#model.components.CombustionHeater">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">CombustionHeater</span><span class="p">(</span><span class="n">ThSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple representation for a combustion heater, e.g. boiler (wood, oil, gas).</span>

<span class="sd">    It is initialized with a name and a list of temperature levels for the feed.</span>
<span class="sd">    Fuel costs need to be given with the var_cost_t parameter. The efficiency of the combustion process can be</span>
<span class="sd">    considered by applying a correction factor to the var_cost_t parameter, e.g. 1/0.9 for 90% combustion efficiency.</span>

<span class="sd">    Additional parameters can also be supplied as keyword arguments.</span>

<span class="sd">    :ivar name: The name of the combustion heater.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :ivar temp_levels_feed: Optional list of temperature levels for the feed.</span>
<span class="sd">    :type temp_levels_feed: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels_feed</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<span class="c1"># direct electric heater</span>
<div class="viewcode-block" id="DirectElHeater"><a class="viewcode-back" href="../../model.html#model.components.DirectElHeater">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DirectElHeater</span><span class="p">(</span><span class="n">ThSource</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Direct electric heater / heating rod.</span>

<span class="sd">    Represents the operation of a heater with a specified constant</span>
<span class="sd">    efficiency, accepting certain temperature levels. The class can be</span>
<span class="sd">    customized through various parameters passed during initialization.</span>

<span class="sd">    :ivar eff: Efficiency of the direct electric heater, representing the</span>
<span class="sd">        ratio of useful heat output to the electric energy consumed.</span>
<span class="sd">    :type eff: float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eff</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff</span> <span class="o">=</span> <span class="n">eff</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels_feed</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="StorageTechnology"><a class="viewcode-back" href="../../model.html#model.components.StorageTechnology">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">StorageTechnology</span><span class="p">(</span><span class="n">Sink</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a storage technology that can act as both a sink and a source.</span>

<span class="sd">    This class encapsulates the functionality for a storage technology, including charging,</span>
<span class="sd">    discharging, and storage efficiency, as well as constraints on power and capacity. It is</span>
<span class="sd">    designed to model energy storage systems with various characteristics and constraints.</span>
<span class="sd">    It is the base class for ThermalStorage and ElectricalStorage.</span>

<span class="sd">    :ivar eff_in: Charging efficiency of the storage technology.</span>
<span class="sd">    :type eff_in: float</span>
<span class="sd">    :ivar eff_out: Discharging efficiency of the storage technology.</span>
<span class="sd">    :type eff_out: float</span>
<span class="sd">    :ivar eff_store: Storage efficiency retained from one timestep to the next.</span>
<span class="sd">    :type eff_store: float</span>
<span class="sd">    :ivar p_max_in: Maximum allowable charging power for the storage technology. UNUSED so far</span>
<span class="sd">    :type p_max_in: float</span>
<span class="sd">    :ivar p_max_out: Maximum allowable discharging power for the storage technology. UNUSED so far</span>
<span class="sd">    :type p_max_out: float</span>
<span class="sd">    :ivar c_max: Maximum energy capacity of the storage technology.</span>
<span class="sd">    :type c_max: float</span>
<span class="sd">    :ivar c_max_rel: Relative maximum charge state of the storage technology, expressed as</span>
<span class="sd">        a fraction of its maximum capacity.</span>
<span class="sd">    :type c_max_rel: float</span>
<span class="sd">    :ivar c_min: Minimum energy capacity of the storage technology.</span>
<span class="sd">    :type c_min: float</span>
<span class="sd">    :ivar c_min_rel: Depth of discharge, expressed as a fraction of maximum capacity.</span>
<span class="sd">    :type c_min_rel: float</span>
<span class="sd">    :ivar c_rate_max: Maximum charge/discharge rate relative to the capacity.</span>
<span class="sd">    :type c_rate_max: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eff_in</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># charging efficiency</span>
    <span class="n">eff_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># discharging efficiency</span>
    <span class="n">eff_store</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># storage efficiency from one timestep to the next</span>
    <span class="n">p_max_in</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p_max_out</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c_max_rel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># max charge state</span>
    <span class="n">c_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">c_min_rel</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># depth of discharge</span>
    <span class="n">c_rate_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">c_max</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="mf">0.999</span><span class="p">,</span> <span class="n">p_max_in</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">p_max_out</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c_max_rel</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c_min_rel</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_in</span> <span class="o">=</span> <span class="n">eff_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_out</span> <span class="o">=</span> <span class="n">eff_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eff_store</span> <span class="o">=</span> <span class="n">eff_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_max_in</span> <span class="o">=</span> <span class="n">p_max_in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_max_out</span> <span class="o">=</span> <span class="n">p_max_out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_max</span> <span class="o">=</span> <span class="n">c_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_max_rel</span> <span class="o">=</span> <span class="n">c_max_rel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_min</span> <span class="o">=</span> <span class="n">c_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_min_rel</span> <span class="o">=</span> <span class="n">c_min_rel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_rate_max</span> <span class="o">=</span> <span class="n">c_rate_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_init_rel</span> <span class="o">=</span> <span class="n">c_init_rel</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElStorage"><a class="viewcode-back" href="../../model.html#model.components.ElStorage">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElStorage</span><span class="p">(</span><span class="n">StorageTechnology</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">,</span> <span class="n">ElSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents an electric storage unit that functions as both an electricity sink and source.</span>

<span class="sd">    This class models the behavior of an energy storage system with parameters for efficiency, capacity,</span>
<span class="sd">    and operational constraints. It supports features such as degradation handling, adjustable maximum</span>
<span class="sd">    charge/discharge rates, and constant voltage charge point configurations.</span>

<span class="sd">    :ivar max_cycles: The maximum number of charge/discharge cycles the storage unit can handle before its</span>
<span class="sd">        end-of-life capacity is reached.</span>
<span class="sd">    :type max_cycles: int</span>
<span class="sd">    :ivar c_max_at_lifeend: The relative maximum capacity of the storage unit at its end of life, expressed</span>
<span class="sd">        as a fraction of the initial maximum capacity.</span>
<span class="sd">    :type c_max_at_lifeend: float</span>
<span class="sd">    :ivar endofcharge_eq_slope_offset: The slope and offset values for the linear equation defining the</span>
<span class="sd">        transition between charging modes (constant current to constant voltage) and</span>
<span class="sd">        the end-of-charge condition.</span>
<span class="sd">    :type endofcharge_eq_slope_offset: tuple[float, float]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">c_max</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_C</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="mf">0.9999</span><span class="p">,</span>
                 <span class="n">p_max_in</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_max_out</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_cycles</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">c_max_at_lifeend</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                 <span class="n">c_max_rel</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">c_min_rel</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span> <span class="n">const_voltage_charge_points</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">c_init_rel</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param degradation_rate: capacity loss per cycle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_cycles</span> <span class="o">=</span> <span class="n">max_cycles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_max_at_lifeend</span> <span class="o">=</span> <span class="n">c_max_at_lifeend</span>
        <span class="k">if</span> <span class="n">const_voltage_charge_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># first point determines SOC at which charging mode switches from constant current to constant voltage</span>
            <span class="c1"># second point is cut-off point for charging</span>
            <span class="n">const_voltage_charge_points</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endofcharge_eq_slope_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_endofcharge_eurrent_eq</span><span class="p">(</span><span class="n">const_voltage_charge_points</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">c_max</span><span class="o">=</span><span class="n">c_max</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="n">c_min</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="n">eff_in</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="n">eff_out</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="n">eff_store</span><span class="p">,</span>
                         <span class="n">p_max_in</span><span class="o">=</span><span class="n">p_max_in</span><span class="p">,</span> <span class="n">p_max_out</span><span class="o">=</span><span class="n">p_max_out</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="n">c_rate_max</span><span class="p">,</span> <span class="n">c_max_rel</span><span class="o">=</span><span class="n">c_max_rel</span><span class="p">,</span>
                         <span class="n">c_min_rel</span><span class="o">=</span><span class="n">c_min_rel</span><span class="p">,</span> <span class="n">co2eq_per_cap</span><span class="o">=</span><span class="n">co2eq_per_cap</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="n">c_init_rel</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_endofcharge_eurrent_eq</span><span class="p">(</span><span class="n">const_voltage_charge_points</span><span class="p">):</span>
        <span class="c1"># Extract x and y values</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">const_voltage_charge_points</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="c1"># Solve for coefficients (slope and intercept)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Create the design matrix</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Solve for slope (m) and intercept (b)</span>

        <span class="k">return</span> <span class="n">slope</span><span class="p">,</span> <span class="n">offset</span></div>


<div class="viewcode-block" id="ThStorage"><a class="viewcode-back" href="../../model.html#model.components.ThStorage">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThStorage</span><span class="p">(</span><span class="n">StorageTechnology</span><span class="p">,</span> <span class="n">ThSink</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Thermal Energy Storage class.</span>

<span class="sd">    This class represents a thermal energy storage system, integrating functionality</span>
<span class="sd">    for defining temperature levels, storage capacities, efficiencies, and other operational</span>
<span class="sd">    constraints. It extends multiple base classes, enabling it to act as both a thermal</span>
<span class="sd">    energy source and sink. The class is designed to model thermal energy storage systems</span>
<span class="sd">    and their behavior in various simulation or real-world setups.</span>

<span class="sd">    :ivar temp_levels: List of temperature levels that define the thermal storage system.</span>
<span class="sd">    :type temp_levels: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">c_max</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_C</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="mf">0.995</span><span class="p">,</span> <span class="n">p_max_in</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">p_max_out</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_levels</span> <span class="o">=</span> <span class="n">temp_levels</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels_drain</span><span class="o">=</span><span class="n">temp_levels</span><span class="p">,</span> <span class="n">temp_levels_feed</span><span class="o">=</span><span class="n">temp_levels</span><span class="p">,</span>
            <span class="n">c_max</span><span class="o">=</span><span class="n">c_max</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="n">c_min</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="n">eff_in</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="n">eff_out</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="n">eff_store</span><span class="p">,</span>
            <span class="n">p_max_in</span><span class="o">=</span><span class="n">p_max_in</span><span class="p">,</span> <span class="n">p_max_out</span><span class="o">=</span><span class="n">p_max_out</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="n">c_rate_max</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="n">c_init_rel</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>
        <span class="c1"># ThSink.__init__(self, name, temp_levels_drain=temp_levels, **params)</span>
        <span class="c1"># ThSource.__init__(self, name, temp_levels_feed=temp_levels, **params)</span>


<div class="viewcode-block" id="ThInertia"><a class="viewcode-back" href="../../model.html#model.components.ThInertia">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThInertia</span><span class="p">(</span><span class="n">ThStorage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a thermal inertia model which calculates the effective storage attributes</span>
<span class="sd">    for a thermal energy storage system based on given parameters. Inherits from the</span>
<span class="sd">    base class ThStorage to provide functionality related to thermal energy storage.</span>

<span class="sd">    This class computes the maximum capacity (`c_max`) and storage efficiency (`eff_store`)</span>
<span class="sd">    based on the specific parameters provided, and ensures the thermal storage model</span>
<span class="sd">    adheres to specified constraints.</span>

<span class="sd">    :ivar name: Name of the thermal inertia instance.</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :ivar temp_levels: List of required temperature levels for operation.</span>
<span class="sd">    :type temp_levels: list</span>
<span class="sd">    :ivar comp_volume: Storage volume in cubic meters.</span>
<span class="sd">    :type comp_volume: float</span>
<span class="sd">    :ivar transm_loss: Heat transmission loss coefficient.</span>
<span class="sd">    :type transm_loss: float</span>
<span class="sd">    :ivar delta_temp_max: Maximum temperature difference in Kelvin.</span>
<span class="sd">    :type delta_temp_max: float</span>
<span class="sd">    :ivar th_cap: Specific heat capacity in Joules per (kilogram * Kelvin).</span>
<span class="sd">    :type th_cap: float</span>
<span class="sd">    :ivar density: Material density in kilograms per cubic meter.</span>
<span class="sd">    :type density: float</span>
<span class="sd">    :ivar c_min: Minimum storage capacity.</span>
<span class="sd">    :type c_min: float</span>
<span class="sd">    :ivar eff_in: Charging efficiency coefficient.</span>
<span class="sd">    :type eff_in: float</span>
<span class="sd">    :ivar eff_out: Discharging efficiency coefficient.</span>
<span class="sd">    :type eff_out: float</span>
<span class="sd">    :ivar eff_store: Storage efficiency, determined by property parameters.</span>
<span class="sd">    :type eff_store: float</span>
<span class="sd">    :ivar c_init_rel: Initial relative capacity as a fraction of maximum capacity.</span>
<span class="sd">    :type c_init_rel: float</span>
<span class="sd">    :ivar p_max_in: Maximum input power in watts.</span>
<span class="sd">    :type p_max_in: float or None</span>
<span class="sd">    :ivar p_max_out: Maximum output power in watts.</span>
<span class="sd">    :type p_max_out: float or None</span>
<span class="sd">    :ivar c_rate_max: Maximum charge rate as a proportion of maximum capacity.</span>
<span class="sd">    :type c_rate_max: float</span>
<span class="sd">    :ivar params: Additional optional parameters for the thermal storage system.</span>
<span class="sd">    :type params: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">comp_volume</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transm_loss</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delta_temp_max</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">th_cap</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span>
                 <span class="n">c_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">p_max_in</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_max_out</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">c_rate_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param comp_volume: in m^3</span>
<span class="sd">        :param delta_temp_max: in K</span>
<span class="sd">        :param th_cap: cp in J/(kg*K)</span>
<span class="sd">        :param density: in kg/m^3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">comp_volume</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transm_loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s2">&quot;ThInertia needs arguments comp_value and transm_loss&quot;</span>
        <span class="n">c_max</span> <span class="o">=</span> <span class="n">comp_volume</span><span class="o">*</span><span class="n">density</span><span class="o">*</span><span class="n">th_cap</span><span class="o">/</span><span class="p">(</span><span class="mf">3.6</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">delta_temp_max</span> <span class="c1"># in kWh</span>
        <span class="k">if</span> <span class="n">c_max</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">eff_store</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">transm_loss</span> <span class="o">*</span> <span class="n">delta_temp_max</span><span class="p">)</span><span class="o">/</span><span class="n">c_max</span>

        <span class="k">if</span> <span class="n">p_max_out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># maximum discharge is assumend to be transmission loss at 30K difference between in and out</span>
            <span class="n">p_max_out</span> <span class="o">=</span> <span class="n">transm_loss</span> <span class="o">*</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">p_max_in</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># maximum charge rate is assumed to be same as max discharge rate</span>
            <span class="n">p_max_in</span> <span class="o">=</span> <span class="n">p_max_out</span>
        <span class="k">if</span> <span class="n">c_rate_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c_rate_max</span> <span class="o">=</span> <span class="n">p_max_out</span><span class="o">/</span><span class="n">c_max</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_levels</span><span class="o">=</span><span class="n">temp_levels</span><span class="p">,</span>
                         <span class="n">c_max</span><span class="o">=</span><span class="n">c_max</span><span class="p">,</span> <span class="n">c_min</span><span class="o">=</span><span class="n">c_min</span><span class="p">,</span> <span class="n">eff_in</span><span class="o">=</span><span class="n">eff_in</span><span class="p">,</span> <span class="n">eff_out</span><span class="o">=</span><span class="n">eff_out</span><span class="p">,</span> <span class="n">eff_store</span><span class="o">=</span><span class="n">eff_store</span><span class="p">,</span>
                         <span class="n">p_max_in</span><span class="o">=</span><span class="n">p_max_in</span><span class="p">,</span> <span class="n">p_max_out</span><span class="o">=</span><span class="n">p_max_out</span><span class="p">,</span> <span class="n">c_rate_max</span><span class="o">=</span><span class="n">c_rate_max</span><span class="p">,</span> <span class="n">c_init_rel</span><span class="o">=</span><span class="n">c_init_rel</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="MultiTempStorage"><a class="viewcode-back" href="../../model.html#model.components.MultiTempStorage">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">MultiTempStorage</span><span class="p">(</span><span class="n">ThStorage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a storage system with multiple temperature levels.</span>

<span class="sd">    This class extends the `ThStorage` class to enable the usage of multiple temperature levels for thermal storage.</span>
<span class="sd">    This is needed to represent the possibility of e.g. raising the temperature in a buffer storage to increase its</span>
<span class="sd">    storage capacity. It calculates the maximum and minimum temperature for the given temperature levels,</span>
<span class="sd">    as well as the maximum temperature differential. The class also</span>
<span class="sd">    includes methods to compute thermal capacity based on the temperature</span>
<span class="sd">    differential and thermal storage properties.</span>

<span class="sd">    :ivar c_max_l: Maximum thermal capacity in liters.</span>
<span class="sd">    :type c_max_l: float</span>
<span class="sd">    :ivar c_min_l: Minimum thermal capacity in liters.</span>
<span class="sd">    :type c_min_l: float</span>
<span class="sd">    :ivar max_temp: Maximum temperature across all temperature levels.</span>
<span class="sd">    :type max_temp: float</span>
<span class="sd">    :ivar min_ret_temp: Minimum return temperature across all temperature levels.</span>
<span class="sd">    :type min_ret_temp: float</span>
<span class="sd">    :ivar max_delta: Maximum temperature differential derived from the</span>
<span class="sd">                    temperature levels.</span>
<span class="sd">    :type max_delta: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_levels</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c_max_l</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">MAX_C_in_l</span><span class="p">,</span> <span class="n">c_min_l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temp_levels</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">FlowTempLevel</span><span class="p">),</span> <span class="s2">&quot;temp_levels needs to be list of FlowTempLevel&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_max_l</span> <span class="o">=</span> <span class="n">c_max_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_min_l</span> <span class="o">=</span> <span class="n">c_min_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">temp</span><span class="o">.</span><span class="n">temp_t</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">temp_t</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
                             <span class="k">else</span> <span class="n">temp</span><span class="o">.</span><span class="n">temp_t</span>
                             <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temp_levels</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_ret_temp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">temp</span><span class="o">.</span><span class="n">return_temp_t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">return_temp_t</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
                                 <span class="k">else</span> <span class="n">temp</span><span class="o">.</span><span class="n">return_temp_t</span>
                                 <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">temp_levels</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_temp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_ret_temp</span>
        <span class="n">c_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_th_capacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_delta</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">c_max</span><span class="o">=</span><span class="n">c_max</span><span class="p">,</span> <span class="n">temp_levels</span><span class="o">=</span><span class="n">temp_levels</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="MultiTempStorage.calc_th_capacity"><a class="viewcode-back" href="../../model.html#model.components.MultiTempStorage.calc_th_capacity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_th_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_temp</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">const</span><span class="o">.</span><span class="n">TH_CAP_WATER_Wh_per_kg_K</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delta_temp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_max_l</span></div></div>


<div class="viewcode-block" id="Export"><a class="viewcode-back" href="../../model.html#model.components.Export">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Export</span><span class="p">(</span><span class="n">Sink</span><span class="p">):</span>
    <span class="n">revenue_per_kwh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revenue_per_kwh</span> <span class="o">=</span> <span class="n">revenue_per_kwh</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElExport"><a class="viewcode-back" href="../../model.html#model.components.ElExport">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElExport</span><span class="p">(</span><span class="n">Export</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="mf">0.082</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="n">revenue_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThExport"><a class="viewcode-back" href="../../model.html#model.components.ThExport">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThExport</span><span class="p">(</span><span class="n">Export</span><span class="p">,</span> <span class="n">ThSink</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="n">revenue_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="Import"><a class="viewcode-back" href="../../model.html#model.components.Import">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Import</span><span class="p">(</span><span class="n">Source</span><span class="p">):</span>
    <span class="n">costs_per_kwh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">costs_per_kWh</span> <span class="o">=</span> <span class="n">costs_per_kwh</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ElImport"><a class="viewcode-back" href="../../model.html#model.components.ElImport">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElImport</span><span class="p">(</span><span class="n">Import</span><span class="p">,</span> <span class="n">ElSource</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">atypical_consumption</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">peak_load_timesteps</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">peak_load_timesteps</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="n">peak_load_timesteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atypical_consumption</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">atypical_consumption</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="n">costs_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThImport"><a class="viewcode-back" href="../../model.html#model.components.ThImport">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThImport</span><span class="p">(</span><span class="n">Import</span><span class="p">,</span> <span class="n">ThSource</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="n">costs_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="Demand"><a class="viewcode-back" href="../../model.html#model.components.Demand">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Demand</span><span class="p">(</span><span class="n">Sink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demand inititalized with timesieres p_t.&quot;&quot;&quot;</span>
    <span class="n">p_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_t</span> <span class="o">=</span> <span class="n">p_t</span></div>


<div class="viewcode-block" id="ElDemand"><a class="viewcode-back" href="../../model.html#model.components.ElDemand">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ElDemand</span><span class="p">(</span><span class="n">Demand</span><span class="p">,</span> <span class="n">ElSink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Electrical demand inititalized with timesieres p_t.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlexElDemand"><a class="viewcode-back" href="../../model.html#model.components.FlexElDemand">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">FlexElDemand</span><span class="p">(</span><span class="n">ElExport</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A flexible demand is a demand which can be flexibly satisfied within a period.</span>
<span class="sd">    They need to be defined in an input dictionary like</span>
<span class="sd">    flex_demands = {</span>
<span class="sd">        &#39;1&#39; : {</span>
<span class="sd">            &#39;period&#39;: list &lt;timeseries indices giving the period&gt;</span>
<span class="sd">            &#39;demand&#39;: float &lt;sum that needs to be delivered within period&gt;</span>
<span class="sd">        }</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">flex_demands</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flex_demands</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">flex_demands</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">revenue_per_kwh</span><span class="o">=</span><span class="n">revenue_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="ThDemand"><a class="viewcode-back" href="../../model.html#model.components.ThDemand">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">ThDemand</span><span class="p">(</span><span class="n">Demand</span><span class="p">,</span> <span class="n">ThSink</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Thermal demand inititalized with timesieres p_t.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param p_t: demand series in kW</span>
<span class="sd">        :param temp_out_t: Outside temperature series in °C</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="RoomheatDemand"><a class="viewcode-back" href="../../model.html#model.components.RoomheatDemand">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">RoomheatDemand</span><span class="p">(</span><span class="n">ThDemand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the room heat demand model, which calculates the heat demand for maintaining</span>
<span class="sd">    indoor temperature based on several factors such as outdoor temperature, transmission loss,</span>
<span class="sd">    ventilation loss, and configurable settings for indoor and nighttime temperatures.</span>

<span class="sd">    This class is a specialized extension of the `ThDemand` class. It determines the</span>
<span class="sd">    time-series of indoor air temperature and calculates temperature differences for heat-demand</span>
<span class="sd">    determination. It also allows custom configuration of parameters like air change rate, ventilation</span>
<span class="sd">    rate, and heating thresholds.</span>

<span class="sd">    :ivar temp_air_t: Time-series of outside air temperatures in °C.</span>
<span class="sd">    :type temp_air_t: pd.Series</span>
<span class="sd">    :ivar indoor_temp: Target indoor temperature during the day in °C.</span>
<span class="sd">    :type indoor_temp: float</span>
<span class="sd">    :ivar indoor_temp_night: Target indoor temperature during the night in °C.</span>
<span class="sd">    :type indoor_temp_night: float</span>
<span class="sd">    :ivar night_interval: Interval of nighttime hours, specified as a two-element list</span>
<span class="sd">                          indicating the start and end hours (24-hour format).</span>
<span class="sd">    :type night_interval: list</span>
<span class="sd">    :ivar use_dayavg_heating_threshold: Whether to use daily average temperature to determine</span>
<span class="sd">                                        heating thresholds.</span>
<span class="sd">    :type use_dayavg_heating_threshold: bool</span>
<span class="sd">    :ivar indoor_temp_t: Time-series of indoor temperature in °C, varying based on day/night settings.</span>
<span class="sd">    :type indoor_temp_t: pd.Series</span>
<span class="sd">    :ivar transm_loss: Transmission heat loss in kW/K.</span>
<span class="sd">    :type transm_loss: float</span>
<span class="sd">    :ivar vent_loss: Calculated ventilation heat loss in kW/K.</span>
<span class="sd">    :type vent_loss: float</span>
<span class="sd">    :ivar delta_temp_t: Time-series of temperature difference (delta T) between indoor and outdoor</span>
<span class="sd">                        temperatures, considering heating thresholds.</span>
<span class="sd">    :type delta_temp_t: pd.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">temp_air_t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">transm_loss</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">air_change</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">AIR_CHANGE</span><span class="p">,</span>
                 <span class="n">vent_rate</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">VENT_RATE</span><span class="p">,</span> <span class="n">indoor_temp</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">NOM_TEMP_INDOOR</span><span class="p">,</span>
                 <span class="n">indoor_temp_night</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">NIGHT_TEMP_INDOOR</span><span class="p">,</span> <span class="n">night_interval</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">use_dayavg_heating_threshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param transm_loss: transmission heat loss in kW/K</span>
<span class="sd">        :param temp_air_t: Outside temperature series in °C</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">night_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">night_interval</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span> <span class="o">=</span> <span class="n">temp_air_t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp</span> <span class="o">=</span> <span class="n">indoor_temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp_night</span> <span class="o">=</span> <span class="n">indoor_temp_night</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">night_interval</span> <span class="o">=</span> <span class="n">night_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_dayavg_heating_threshold</span> <span class="o">=</span> <span class="n">use_dayavg_heating_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_indoor_temp_t</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transm_loss</span> <span class="o">=</span> <span class="n">transm_loss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vent_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_vent_loss</span><span class="p">(</span><span class="n">air_change</span><span class="p">,</span> <span class="n">vent_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_temp_t</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p_t</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(),</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_vent_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">air_change</span><span class="p">,</span> <span class="n">vent_rate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        H_V = n_L * V_L * 0,34 Wh/(m3*K)</span>
<span class="sd">        :param air_change: n_L without unit</span>
<span class="sd">        :param vent_rate: V_L air flow in m^3/h</span>
<span class="sd">        :return: ventilation loss H_V in kW/K</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">air_change</span> <span class="o">*</span> <span class="n">vent_rate</span> <span class="o">*</span> <span class="mf">0.34</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_indoor_temp_t</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">indoor_temp_t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">night_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span>
                      <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">TS_PER_HOUR</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">night_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">TS_PER_HOUR</span>
                       <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">night_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">indoor_temp_t</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">indoor_temp_t</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">night_inds</span><span class="p">)]</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp_night</span>
        <span class="k">return</span> <span class="n">indoor_temp_t</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_temp_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s1">&#39;temp_air&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="p">,</span>
                <span class="s1">&#39;daily_avg_temp&#39;</span><span class="p">:</span> <span class="n">calc_for_blocks_of_n</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_air_t</span><span class="p">),</span>
                <span class="s1">&#39;indoor_temp&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">indoor_temp_t</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_dayavg_heating_threshold</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;daily_avg_temp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">const</span><span class="o">.</span><span class="n">HEATING_THRESHOLD</span>
                <span class="k">else</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;indoor_temp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;temp_air&#39;</span><span class="p">]),</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_t</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;indoor_temp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;temp_air&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;indoor_temp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;temp_air&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_t</span></div>


<div class="viewcode-block" id="HeatGains"><a class="viewcode-back" href="../../model.html#model.components.HeatGains">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">HeatGains</span><span class="p">(</span><span class="n">ThImport</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents the heat gains of a room by accounting for various factors such as</span>
<span class="sd">    temperature differences, internal gains, and solar potentials.</span>

<span class="sd">    This class models the heat balance in a room environment by calculating the</span>
<span class="sd">    temperature difference, transmission and ventilation losses, as well as the</span>
<span class="sd">    internal and solar heat gains. It is particularly useful for energy modeling</span>
<span class="sd">    and understanding heat demand dynamics.</span>

<span class="sd">    The purpose of this class is to compute these values based on the provided</span>
<span class="sd">    demand and solar potentials, enabling users to assess the energy behavior in</span>
<span class="sd">    varied conditions.</span>

<span class="sd">    :ivar delta_temp_t: Temperature difference between outdoor and indoor air</span>
<span class="sd">        temperature, calculated only if outdoor temperature is higher than</span>
<span class="sd">        indoor temperature.</span>
<span class="sd">    :type delta_temp_t: pandas.Series</span>
<span class="sd">    :ivar transm_loss: The transmission heat loss derived from the given room heat</span>
<span class="sd">        demand.</span>
<span class="sd">    :type transm_loss: float</span>
<span class="sd">    :ivar vent_loss: The ventilation heat loss derived from the given room heat</span>
<span class="sd">        demand.</span>
<span class="sd">    :type vent_loss: float</span>
<span class="sd">    :ivar internal_gains_t: The internal heat gains over time, based on predefined</span>
<span class="sd">        constants or values provided.</span>
<span class="sd">    :type internal_gains_t: pandas.Series</span>
<span class="sd">    :ivar solar_gains_t: The solar heat gains over time, calculated based on the</span>
<span class="sd">        provided solar potentials.</span>
<span class="sd">    :type solar_gains_t: pandas.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">RoomheatDemand</span><span class="p">,</span> <span class="n">solar_potentials</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">internal_gains</span><span class="o">=</span><span class="n">const</span><span class="o">.</span><span class="n">INTERNAL_GAINS</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delta_temp_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_temp_t</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transm_loss</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">transm_loss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vent_loss</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">vent_loss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_gains_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_internal_gains</span><span class="p">(</span><span class="n">internal_gains</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solar_gains_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_solar_gains</span><span class="p">(</span><span class="n">solar_potentials</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">costs_per_kwh</span><span class="o">=</span><span class="n">costs_per_kwh</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_temp_t</span><span class="p">(</span><span class="n">demand</span><span class="p">:</span> <span class="n">RoomheatDemand</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">demand</span><span class="o">.</span><span class="n">temp_air_t</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">demand</span><span class="o">.</span><span class="n">indoor_temp</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">demand</span><span class="o">.</span><span class="n">indoor_temp</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_internal_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">internal_gains</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">internal_gains</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_temp_t</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_solar_gains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solar_potentials</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Q_S = sum(r*g_i*A_W,i*G_solar,i) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">solar_potentials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gains_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="n">pot</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">pot</span><span class="o">.</span><span class="n">rad_corr_factor</span> <span class="o">*</span> <span class="n">pot</span><span class="o">.</span><span class="n">g_val</span> <span class="o">*</span> <span class="n">pot</span><span class="o">.</span><span class="n">window_area_m2</span> <span class="o">*</span> <span class="n">pot</span><span class="o">.</span><span class="n">total_rad_t</span> <span class="o">/</span> <span class="mi">1000</span>
                 <span class="k">for</span> <span class="n">pot</span> <span class="ow">in</span> <span class="n">solar_potentials</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">gains_tot</span> <span class="o">=</span> <span class="n">gains_i</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gains_tot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">gains_tot</span></div>


<div class="viewcode-block" id="Refurbishment"><a class="viewcode-back" href="../../model.html#model.components.Refurbishment">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Refurbishment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a refurbishment component that is capable of reducing demand</span>
<span class="sd">    by a specified factor.</span>

<span class="sd">    :ivar dem_red_factor: Demand reduction factor achieved through refurbishment.</span>
<span class="sd">    :type dem_red_factor: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">dem_red_factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dem_red_factor: demand reduction achieved through refurbishment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dem_red_factor</span> <span class="o">=</span> <span class="n">dem_red_factor</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
    <span class="c1"># pv = PV()</span>
    <span class="c1"># rad_profile = prep_climate_and_rad_data()</span>
    <span class="c1"># pv.calc_p_el_t(rad_profile)</span>
    <span class="c1"># print(&quot;&quot;)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Erik Froehlich.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>